{
    "$schema": "http://json-schema.org/draft-04/schema#",
    "$id": "https://e-rihs.io/schema/kpi_definition-v1.0.schema.json",
    "$code": "2299",
    "title": "KPI Definition",
    "type": "object",
    "required": ["id", "title", "scope", "target_metrics"],
    "properties": {
        "$schema": {
            "type": "string",
            "options": {
                "hidden": true
            }
        },
        "id": {
            "type": "string",
            "cordra": {
                "type": {
                    "autoGeneratedField": "handle"
                }
            }
        },
        "title": {
            "title": "Title",
            "type": "string",
            "minLength": 2,
            "cordra": {
                "preview": {
                    "showInPreview": true,
                    "isPrimary": true
                }
            }
        },
        "scope": {
            "title": "Scope of the KPI",
            "type": "array",
            "minItems": 1,
            "description": "The subject that is being assessed by the KPI.",
            "items": {
                "type": "string",
                "minLenght": 2,
                "enum": [
                    "actor",
                    "dataset",
                    "method",
                    "platform",
                    "project",
                    "repository",
                    "service",
                    "tool",
                    "website"
                ]
            }
        },
        "description": {
            "title": "Description",
            "type": "string",
            "format": "textarea",
            "minLength": 2,
            "description": "A brief description of the purpose of the KPI and the sources of information it is based on. Details of specific calculations will be recorded within the 'formula' field.",
            "cordra": {
                "preview": {
                    "showInPreview": true
                }
            }
        },
        "target_metrics": {
            "title": "Target metrics",
            "type": "array",
            "minItems": 1,
            "description": "Target metrics for the KPI (that will be used for evaluation).",
            "items": {
                "type": "object",
                "required": ["key", "value", "metric_check"],
                "properties": {
                    "key": {
                        "title": "Key",
                        "type": "string",
                        "minLength": 2,
                        "description": "The key of the target metric"
                    },
                    "value": {
                        "title": "Value",
                        "type": ["number", "string", "boolean"],
                        "description": "The value of the target metric"
                    },
                    "unit": {
                        "title": "Unit",
                        "type": "string",
                        "description": "The unit of the target metric"
                    },
                    "metric_check": {
                        "title": "Metric check",
                        "type": "string",
                        "description": "The metric check to be used for evaluation",
                        "enum": [
                            "Exists",
                            "Is equal",
                            "Is not equal",
                            "Is greater than",
                            "Is greater than or equal",
                            "Is less than",
                            "Is less than or equal",
                            "Is true",
                            "Is false"
                        ]
                    }
                }
            }
        },
        "access_level": {
            "title": "Access level",
            "type": "string",
            "description": "The level of access on which the KPI score or value is relevant - Global, EU - E-RIHS, National - French, National - Greek, Institutional - National Gallery, Personal etc."
        },
        "period_class": {
            "title": "Time period or event",
            "type": "string",
            "description": "The time period or the event the KPI is relevant to.",
            "$ref": "https://e-rihs.io/schema/controlled_lists.schema.json#/definitions/period_class"
        },
        "function": {
            "title": "Function",
            "type": "string",
            "format": "textarea",
            "description": "The KPI function is a machine readable description of how the values for a given KPI are gathered or calculated, either from the local database or from external services. It is expected to take the form of a script, programming function, database query or a URL."
        }
    }
}
